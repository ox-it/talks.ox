{% extends "layouts/2-column.html" %}
{% load staticfiles %}

{% block title %}Events{% endblock %}

{% block extrahead %}
<script src="{% static "js/user-collections.js"%}"></script>
<script>
    document.collectionConfig = {
        yourTalkTemplate: _.template('<li><strong><%= event.formatted_date %></strong> - <a href="<%= event.url %>"><%= event.title %></a> <a data-event="<%= event.id %>" href="#" class="js-remove-from-collection"><span class="glyphicon glyphicon-minus text-warning"></span></a></li>'),
        yourGroupTemplate: _.template('<li><a href="<%= group.url %>"><%= group.title %></a> <a data-group="<%= group.id %>" href="#" class="js-remove-from-collection"><span class="glyphicon glyphicon-minus text-warning"></span></a></li>'),
        saveItemDefault: "{% url "save-item" %}",
        removeItemDefault: "{% url "remove-item" %}",
    };
</script>
<script type="application/ld+json">
[{% for event in events %}{
  "@context": "http://schema.org",
  "@type": "Event",
  "name": "{{ event.title }}",
  "startDate": "{{ event.start|date:'c' }}"
{% if forloop.last %}}{% else %}},{% endif %}{% endfor %}]
</script>

    <link href="{% static "css/bootstrap-datetimepicker.css"%}" rel="stylesheet">
    <script src="{% static "js/bootstrap-datetimepicker.js"%}"></script>

{% endblock %}


{% block topcontent %}
<ul class="visible-xs nav nav-tabs nav-justified" role="tablist">
  <li class="active"><a href="#upcoming">Upcoming</a></li>
  <li><a href="#yourtalks">Your Talks</a></li>
</ul>
{% endblock %}

{% block side %}
<h2 class="hidden-xs">Your Talks</h2>

{% if default_collection %}
<div class="js-your-collection">
    <ul class="list-unstyled js-your-talks">
        {% for event in user_events %}
        <li><strong>{{ event.formatted_date }}</strong> - <a href="{{ event.get_absolute_url }}">{{ event.title }}</a> <a data-event="{{ event.id }}" href="#" class="js-remove-from-collection"><span class="glyphicon glyphicon-minus text-warning"></span></a></li>
        {% endfor %}
    </ul>
    <ul class="list-unstyled js-your-groups">
        {% for evg in user_event_groups %}
        <li><a href="{{ evg.get_absolute_url }}">{{ evg.title }}</a><a data-group="{{ evg.id }}" href="#" class="js-remove-from-collection"><span class="glyphicon glyphicon-minus text-warning"></span></a>
        {% endfor %}
    </ul>
</div>
{% endif %}

{% endblock %}

{% block main %}
<h2 class="hidden-xs">Upcoming</h2>

    <a href="/">Today</a>
    <a href="/?next_days=7">Next 7 days</a>
    <a class="js-datetimepicker" id="js-calendar">Calendar</a>
    
<div class="js-upcoming-events">
    <ul class="list-unstyled">
        {% for event in events %}
        <li><strong>{{ event.formatted_time }}</strong> - <a href="{{ event.get_absolute_url }}">{{ event.title }}</a>{% if event.group %} - Part of: <a href="{{ event.group.get_absolute_url }}">{{ event.group.title }}</a>{% endif %}{% if default_collection %} <a data-event="{{ event.id }}" class="js-add-to-collection{% if event in user_events %} hidden{% endif %}" href="#"><span class="glyphicon glyphicon-plus text-success"></span></a>{% endif %}</li>
        {% endfor %}
    </ul>

    {% if conferences %}
    <h3>Conferences</h3>
    <ul class="list-unstyled">
        {% for conf in conferences %}
        <li><a href="{{ conf.get_absolute_url }}">{{ conf.title }}</a>{% if default_collection %} <a data-group="{{ conf.id }}" class="js-add-to-collection{% if conf in user_event_groups %} hidden{% endif %}" href="#"><span class="glyphicon glyphicon-plus text-success"></span></a>{% endif %}</li>
        {% endfor %}
    </ul>
    {% endif %}

    {% if series %}
    <h3>Seminar Series</h3>
    <ul class="list-unstyled">
        {% for serie in series %}
        <li><a href="{{ serie.get_absolute_url }}">{{ serie.title }}</a>{% if default_collection %} <a data-group="{{ serie.id }}" class="js-add-to-collection{% if serie in user_event_groups %} hidden{% endif %}" href="#"><span class="glyphicon glyphicon-plus text-success"></span></a>{% endif %}</li>
        {% endfor %}
    </ul>
    {% endif %}

    {% if group_no_type %}
    <h3>Other events</h3>
    <ul class="list-unstyled">
        {% for group in group_no_type %}
        <li><a href="{{ group.get_absolute_url }}">{{ group.title }}</a>{% if default_collection %} <a data-group="{{ group.id }}" class="js-add-to-collection{% if group in user_event_groups %} hidden{% endif %}" href="#"><span class="glyphicon glyphicon-plus text-success"></span></a>{% endif %}</li>
        {% endfor %}
    </ul>
    {% endif %}
</div>


    <script type="application/javascript">

    var JS_CALENDAR = '#js-calendar';

    $(JS_CALENDAR).datetimepicker({
        format: 'dd/mm/yyyy',
        autoclose: true,
        minView: 2,
        maxView: 3,
        todayHighlight: true
    });

    var datepicker = $(JS_CALENDAR);
    datepicker.datetimepicker().on('changeDate', function(ev){
        var d = datepicker.datetimepicker('getUTCDate');
        // month is 0-11
        var month = d.getMonth() + 1;
        month = month.toString();
        if (month.length == 1) {
            month = '0' + month;
        }
        var day = d.getDate().toString();
        if (day.length == 1) {
            day = '0' + day;
        }
        window.location = '/events/date/'+d.getFullYear()+'/'+month+'/'+day+'/';
    });

    $(JS_CALENDAR).on('click', function(ev) {
        $(JS_CALENDAR).datetimepicker('show');
    });
    </script>

{% endblock %}
